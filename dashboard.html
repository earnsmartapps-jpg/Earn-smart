<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fintech Dashboard</title>

<style>
body{
margin:0;
font-family:Arial,Helvetica,sans-serif;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
}

header{
background:#111;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
}

button{
padding:10px;
border:none;
border-radius:6px;
cursor:pointer;
font-weight:bold;
}

.green{background:#00c853;color:white;}
.red{background:#d50000;color:white;}
.blue{background:#2962ff;color:white;}

.card{
background:#1e1e1e;
margin:15px;
padding:15px;
border-radius:10px;
box-shadow:0 0 20px rgba(0,255,150,0.15);
}

input,select{
width:100%;
padding:8px;
margin:6px 0;
border-radius:5px;
border:none;
}

.wallet{
background:#111;
padding:8px;
border-radius:6px;
word-break:break-all;
}

.hidden{display:none;}

.dollar{
position:fixed;
font-size:22px;
color:#00ff99;
animation:float 6s linear infinite;
opacity:0.3;
}

@keyframes float{
0%{transform:translateY(100vh);}
100%{transform:translateY(-10vh);}
}
</style>
</head>

<body>

<header>
<h3>ðŸ’° Fintech Dashboard</h3>
<button class="red" onclick="logout()">Logout</button>
</header>

<div class="card">
<h3>Email (Profile ID): <span id="email">Loading...</span></h3>
<h3>Balance: $<span id="balance">0.00</span></h3>
<h3>Earnings: $<span id="earnings">0.00</span></h3>
</div>

<div class="card">
<h3>Investment Plans</h3>
<select id="planSelect">
<option value="">Select Plan</option>
<option value="5">Starter - $5 (5% daily)</option>
<option value="10">Silver - $10 (5% daily)</option>
<option value="20">Diamond - $20 (10% daily)</option>
</select>
<button class="green" onclick="activatePlan()">Activate Plan</button>
</div>

<div class="card">
<h3>Deposit</h3>
<p>Send to:</p>
<div class="wallet">TRC20: TKJAvkyjdDSzKtS1HihiKno1tTfi2bTJJe</div>
<div class="wallet">BEP20/ERC20: 0xB66E1e0e5452489298bebd7Cd463587E6866baD2</div>

<input type="number" id="depositAmount" placeholder="Enter Amount Sent">
<button class="blue" onclick="submitDeposit()">Submit Deposit</button>
</div>

<div class="card">
<h3>Withdraw</h3>
<input type="number" id="withdrawAmount" placeholder="Enter Amount">
<button class="green" onclick="withdraw()">Withdraw</button>
</div>

<div class="card">
<h3>Referral</h3>
<div class="wallet" id="refLink"></div>
</div>

<div class="card hidden" id="adminPanel">
<h3>Admin Panel - Approve Deposits</h3>
<div id="depositRequests"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, setPersistence, browserLocalPersistence, onAuthStateChanged, signOut }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, set, get, update, push, onValue }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAZP0UPvfCgiiir2zKLMae25dUpVcyP3iw",
  authDomain: "crypto-gainz-3524d.firebaseapp.com",
  databaseURL: "https://crypto-gainz-3524d-default-rtdb.firebaseio.com",
  projectId: "crypto-gainz-3524d",
  storageBucket: "crypto-gainz-3524d.firebasestorage.app",
  messagingSenderId: "270349829717",
  appId: "1:270349829717:web:6e3e2bf25f9ab60b2a76dc"
};

const ADMIN_EMAIL = "earnsmartapps@gmail.com";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* ðŸ”¥ FIX AUTO LOGOUT */
await setPersistence(auth, browserLocalPersistence);

let currentUser;

onAuthStateChanged(auth, async(user)=>{
if(!user){
window.location.href="index.html";
return;
}

currentUser=user;
document.getElementById("email").innerText=user.email;
document.getElementById("refLink").innerText=
window.location.origin + "/?ref=" + user.email;

/* CREATE USER IF NOT EXIST */
const userRef=ref(db,"users/"+user.uid);
const snap=await get(userRef);

if(!snap.exists()){
await set(userRef,{
email:user.email,
balance:0,
earnings:0,
plan:null
});
}

/* LIVE UPDATE */
onValue(userRef,(snapshot)=>{
let data=snapshot.val();
document.getElementById("balance").innerText=(data.balance||0).toFixed(2);
document.getElementById("earnings").innerText=(data.earnings||0).toFixed(2);
});

/* ADMIN PANEL */
if(user.email===ADMIN_EMAIL){
document.getElementById("adminPanel").classList.remove("hidden");
loadDeposits();
}
});

/* SUBMIT DEPOSIT */
window.submitDeposit=async()=>{
let amt=parseFloat(document.getElementById("depositAmount").value);
if(!amt) return alert("Enter amount");

await push(ref(db,"deposits"),{
uid:currentUser.uid,
email:currentUser.email,
amount:amt,
status:"pending",
date:Date.now()
});

alert("Deposit submitted. Waiting for admin approval.");
};

/* ADMIN LOAD */
function loadDeposits(){
onValue(ref(db,"deposits"),(snapshot)=>{
let data=snapshot.val();
let html="";
for(let id in data){
let d=data[id];
if(d.status==="pending"){
html+=`
<div>
User: ${d.email}<br>
Amount: $${d.amount}<br>
<button onclick="approve('${id}','${d.uid}',${d.amount})" class="green">Approve</button>
<hr>
</div>`;
}
}
document.getElementById("depositRequests").innerHTML=html;
});
}

window.approve=async(id,uid,amount)=>{
const userRef=ref(db,"users/"+uid);
const snap=await get(userRef);
let bal=snap.val().balance||0;

await update(userRef,{balance:bal+amount});
await update(ref(db,"deposits/"+id),{status:"approved"});
alert("Deposit Approved");
};

/* ACTIVATE PLAN */
window.activatePlan=async()=>{
let amount=parseFloat(document.getElementById("planSelect").value);
if(!amount) return alert("Select plan");

const userRef=ref(db,"users/"+currentUser.uid);
const snap=await get(userRef);
let data=snap.val();

if(data.balance<amount){
alert("Insufficient balance");
return;
}

await update(userRef,{
balance:data.balance-amount,
plan:{
amount:amount,
start:Date.now()
}
});

alert("Plan Activated");
};

/* WITHDRAW */
window.withdraw=async()=>{
let amount=parseFloat(document.getElementById("withdrawAmount").value);
const userRef=ref(db,"users/"+currentUser.uid);
const snap=await get(userRef);
let data=snap.val();

if(amount>data.balance){
alert("Insufficient balance");
return;
}

await update(userRef,{
balance:data.balance-amount
});

alert("Withdrawal submitted");
};

window.logout=function(){
signOut(auth).then(()=>{
window.location.href="index.html";
});
};
</script>

<script>
for(let i=0;i<20;i++){
let d=document.createElement("div");
d.className="dollar";
d.innerText="$";
d.style.left=Math.random()*100+"%";
d.style.animationDuration=(3+Math.random()*5)+"s";
document.body.appendChild(d);
}
</script>

</body>
  </html>
