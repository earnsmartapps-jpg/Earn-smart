<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fintech Pro Dashboard</title>

<style>
body{
margin:0;
font-family:Arial,Helvetica,sans-serif;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
}

header{
padding:15px;
background:#111;
display:flex;
justify-content:space-between;
align-items:center;
}

button{
padding:10px;
border:none;
border-radius:6px;
cursor:pointer;
background:#00ff99;
font-weight:bold;
}

.card{
background:#1c1c1c;
margin:15px;
padding:15px;
border-radius:10px;
box-shadow:0 0 15px rgba(0,255,0,0.2);
}

h2{color:#00ff99;}

input,select{
width:100%;
padding:8px;
margin:5px 0;
border-radius:5px;
border:none;
}

.adminBox{
background:#2a0000;
padding:15px;
margin:15px;
border-radius:10px;
display:none;
}

</style>
</head>

<body>

<header>
<h3>ðŸ’° Fintech Pro</h3>
<button onclick="logout()">Logout</button>
</header>

<div class="card">
<h2>Profile</h2>
<p><b>Email (Profile ID):</b> <span id="email"></span></p>
<p><b>Balance:</b> $<span id="balance">0.00</span></p>
<p><b>Total Earnings:</b> $<span id="earnings">0.00</span></p>
<p><b>Active Plan:</b> <span id="activePlan">None</span></p>
</div>

<div class="card">
<h2>Investment Plans (30 Days)</h2>
<select id="planSelect">
<option value="5">Starter - $5 (Earn $0.25 Daily)</option>
<option value="20">Silver - $20 (Earn $1 Daily)</option>
<option value="50">Gold - $50 (Earn $2.5 Daily)</option>
</select>
<button onclick="activatePlan()">Activate Plan</button>
</div>

<div class="card">
<h2>Deposit</h2>
<p><b>TRC20 USDT:</b><br>TKJAvkyjdDSzKtS1HihiKno1tTfi2bTJJe</p>
<p><b>BEP20:</b><br>0xB66E1e0e5452489298bebd7Cd463587E6866baD2</p>
<p><b>ERC20:</b><br>0xB66E1e0e5452489298bebd7Cd463587E6866baD2</p>
<input type="number" id="depositAmount" placeholder="Enter Amount">
<button onclick="submitDeposit()">Submit Deposit</button>
</div>

<div class="card">
<h2>Withdraw</h2>
<input type="number" id="withdrawAmount" placeholder="Enter Amount">
<button onclick="withdraw()">Request Withdrawal</button>
</div>

<div class="card">
<h2>Referral</h2>
<p>Your Link:</p>
<p id="refLink"></p>
</div>

<!-- ADMIN PANEL -->
<div class="adminBox" id="adminPanel">
<h2>Admin Panel</h2>
<h3>Pending Deposits</h3>
<div id="depositList"></div>

<h3>Pending Withdrawals</h3>
<div id="withdrawList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut,setPersistence,browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase,ref,set,get,update,onValue,push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_DOMAIN",
  databaseURL: "YOUR_DB_URL",
  projectId: "YOUR_PROJECT_ID",
  appId: "YOUR_APP_ID"
};

const ADMIN_EMAIL = "earnsmartapps@gmail.com";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

await setPersistence(auth, browserLocalPersistence);

let currentUser;

onAuthStateChanged(auth, async (user)=>{
if(!user){
window.location.replace("index.html");
return;
}

currentUser=user;
document.getElementById("email").innerText=user.email;
document.getElementById("refLink").innerText=
window.location.origin+"/?ref="+user.uid;

if(user.email===ADMIN_EMAIL){
document.getElementById("adminPanel").style.display="block";
loadAdmin();
}

const userRef=ref(db,"users/"+user.uid);
const snap=await get(userRef);

if(!snap.exists()){
await set(userRef,{
email:user.email,
balance:0,
earnings:0,
plan:null,
activationDate:null,
lastPaid:null,
refBy:null
});
}

onValue(userRef,(s)=>{
let d=s.val();
if(!d) return;

document.getElementById("balance").innerText=(d.balance||0).toFixed(2);
document.getElementById("earnings").innerText=(d.earnings||0).toFixed(2);
document.getElementById("activePlan").innerText=d.plan? "$"+d.plan:"None";

checkDailyProfit(d);
checkExpiration(d);
});
});

/* DAILY PROFIT */
async function checkDailyProfit(d){
if(!d.plan||!d.activationDate) return;

let now=Date.now();
let oneDay=86400000;

if(!d.lastPaid||now-d.lastPaid>=oneDay){
let daily=d.plan*0.05;
await update(ref(db,"users/"+currentUser.uid),{
balance:(d.balance||0)+daily,
earnings:(d.earnings||0)+daily,
lastPaid:now
});
}
}

/* PLAN EXPIRATION */
async function checkExpiration(d){
if(!d.activationDate) return;
let now=Date.now();
let thirty=30*86400000;

if(now-d.activationDate>=thirty){
await update(ref(db,"users/"+currentUser.uid),{
plan:null,
activationDate:null,
lastPaid:null
});
alert("Plan expired after 30 days");
}
}

/* ACTIVATE PLAN */
window.activatePlan=async function(){
let amount=parseFloat(document.getElementById("planSelect").value);
let uRef=ref(db,"users/"+currentUser.uid);
let snap=await get(uRef);
let d=snap.val();

if(d.balance<amount) return alert("Deposit first");

await update(uRef,{
balance:d.balance-amount,
plan:amount,
activationDate:Date.now(),
lastPaid:Date.now()
});

alert("Plan Activated!");
};

/* DEPOSIT */
window.submitDeposit=async function(){
let amount=parseFloat(document.getElementById("depositAmount").value);
if(!amount) return alert("Enter amount");

await push(ref(db,"deposits"),{
uid:currentUser.uid,
email:currentUser.email,
amount:amount,
status:"pending",
date:Date.now()
});
alert("Deposit submitted for approval");
};

/* WITHDRAW */
window.withdraw=async function(){
let amount=parseFloat(document.getElementById("withdrawAmount").value);
if(!amount) return alert("Enter amount");

await push(ref(db,"withdrawals"),{
uid:currentUser.uid,
email:currentUser.email,
amount:amount,
status:"pending",
date:Date.now()
});
alert("Withdrawal request sent");
};

/* ADMIN LOAD */
function loadAdmin(){
onValue(ref(db,"deposits"),(s)=>{
let html="";
s.forEach(child=>{
let d=child.val();
if(d.status==="pending"){
html+=`
<p>${d.email} - $${d.amount}
<button onclick="approveDeposit('${child.key}','${d.uid}',${d.amount})">Approve</button>
</p>`;
}
});
document.getElementById("depositList").innerHTML=html;
});

onValue(ref(db,"withdrawals"),(s)=>{
let html="";
s.forEach(child=>{
let d=child.val();
if(d.status==="pending"){
html+=`
<p>${d.email} - $${d.amount}
<button onclick="approveWithdraw('${child.key}','${d.uid}',${d.amount})">Approve</button>
</p>`;
}
});
document.getElementById("withdrawList").innerHTML=html;
});
}

/* APPROVE DEPOSIT */
window.approveDeposit=async function(id,uid,amount){
await update(ref(db,"deposits/"+id),{status:"approved"});

let uRef=ref(db,"users/"+uid);
let snap=await get(uRef);
let d=snap.val();

await update(uRef,{
balance:(d.balance||0)+amount
});

/* REFERRAL BONUS 10% */
if(d.refBy){
let rRef=ref(db,"users/"+d.refBy);
let rsnap=await get(rRef);
let rd=rsnap.val();
await update(rRef,{
balance:(rd.balance||0)+(amount*0.1)
});
}

alert("Deposit Approved");
};

/* APPROVE WITHDRAW */
window.approveWithdraw=async function(id,uid,amount){
await update(ref(db,"withdrawals/"+id),{status:"approved"});

let uRef=ref(db,"users/"+uid);
let snap=await get(uRef);
let d=snap.val();

await update(uRef,{
balance:(d.balance||0)-amount
});

alert("Withdrawal Approved");
};

window.logout=function(){
signOut(auth);
};
</script>
</body>
  </html>
