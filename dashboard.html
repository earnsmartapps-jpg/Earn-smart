<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Earn Smart - Dashboard</title>

<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#0f2027,#1e3c72,#2a5298);
  color:white;
}
.container{padding:20px;max-width:900px;margin:auto;}
.card{
  background:rgba(255,255,255,0.08);
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
}
button{
  padding:10px;
  border:none;
  border-radius:8px;
  background:#22c55e;
  color:white;
  cursor:pointer;
}
button:hover{background:#16a34a;}
input,select{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:none;
}
.wallet-box{
  background:#111827;
  padding:12px;
  border-radius:8px;
  margin-top:10px;
  word-break:break-all;
  font-size:13px;
}
.copy-btn{
  background:#3b82f6;
  margin-top:8px;
}
.small{font-size:12px;color:#ccc;}
.hidden{display:none;}
.success{color:#22c55e;font-size:13px;margin-top:8px;}
</style>
</head>
<body>

<div class="container">

<h2>Dashboard</h2>

<div class="card">
<h3>Balance: $<span id="balance">0</span></h3>
</div>

<!-- DEPOSIT -->
<div class="card">
<h3>Deposit To Activate Plan</h3>

<select id="planSelect">
<option value="starter">Starter - $5 (5% daily 30 days)</option>
<option value="silver">Silver - $10 (5% daily 30 days)</option>
<option value="diamond">Diamond - $20 (10% daily 30 days)</option>
</select>

<select id="networkSelect">
<option value="">Select Network</option>
<option value="trc20">USDT TRC20</option>
<option value="bsc">BSC BEP20</option>
<option value="erc20">USDT ERC20</option>
</select>

<button onclick="showWallet()">Generate Deposit Address</button>

<div id="walletSection" class="hidden">
<div class="wallet-box" id="walletAddress"></div>
<button class="copy-btn" onclick="copyWallet()">Copy Address</button>
<div class="success hidden" id="copySuccess">Address copied!</div>
<button style="margin-top:10px;" onclick="submitDeposit()">I Have Sent Payment</button>
</div>

<p class="small">Send exact amount. Admin must approve before balance updates.</p>
</div>

<!-- INVEST -->
<div class="card">
<h3>Start Investment (After Deposit Approval)</h3>
<button onclick="startInvestment()">Use Balance To Invest</button>
</div>

<!-- WITHDRAW -->
<div class="card">
<h3>Withdraw</h3>
<input type="number" id="withdrawAmount" placeholder="Amount">
<input type="text" id="withdrawWallet" placeholder="Wallet">
<select id="withdrawNetwork">
<option>TRC20</option>
<option>BSC BEP20</option>
<option>ERC20</option>
</select>
<button onclick="requestWithdraw()">Request Withdrawal</button>
</div>

<div class="card">
<h3>My Investments</h3>
<div id="investments"></div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, push, onValue, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  databaseURL: "YOUR_DB_URL",
  projectId: "YOUR_PROJECT_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let selectedWallet="";
let selectedNetwork="";

onAuthStateChanged(auth,(user)=>{
if(!user){window.location="index.html";return;}
loadUser(user);
loadInvestments(user);
});

/* LOAD USER */
function loadUser(user){
onValue(ref(db,'users/'+user.uid),(snap)=>{
document.getElementById("balance").innerText =
(snap.val()?.balance||0).toFixed(2);
});
}

/* SHOW WALLET */
window.showWallet = ()=>{
const network=document.getElementById("networkSelect").value;

if(!network) return alert("Select network");

if(network==="trc20"){
selectedWallet="TKJAvkyjdDSzKtS1HihiKno1tTfi2bTJJe";
selectedNetwork="USDT TRC20";
}
if(network==="bsc"){
selectedWallet="0xB66E1e0e5452489298bebd7Cd463587E6866baD2";
selectedNetwork="BSC BEP20";
}
if(network==="erc20"){
selectedWallet="0xB66E1e0e5452489298bebd7Cd463587E6866baD2";
selectedNetwork="USDT ERC20";
}

document.getElementById("walletAddress").innerText=selectedWallet;
document.getElementById("walletSection").classList.remove("hidden");
};

/* COPY FUNCTION */
window.copyWallet = ()=>{
navigator.clipboard.writeText(selectedWallet);
document.getElementById("copySuccess").classList.remove("hidden");
setTimeout(()=>{
document.getElementById("copySuccess").classList.add("hidden");
},2000);
};

/* SUBMIT DEPOSIT */
window.submitDeposit = async()=>{
const user=auth.currentUser;
const plan=document.getElementById("planSelect").value;
let amount= plan==="starter"?5:plan==="silver"?10:20;

await push(ref(db,'deposits'),{
uid:user.uid,
amount,
plan,
network:selectedNetwork,
status:"pending",
date:Date.now()
});

alert("Deposit submitted. Wait for admin approval.");
};

/* START INVESTMENT */
window.startInvestment = async()=>{
const user=auth.currentUser;
const plan=document.getElementById("planSelect").value;
let amount= plan==="starter"?5:plan==="silver"?10:20;

const snap=await get(ref(db,'users/'+user.uid));
let balance=snap.val()?.balance||0;

if(balance<amount) return alert("Deposit must be approved first.");

await update(ref(db,'users/'+user.uid),{
balance:balance-amount
});

await push(ref(db,'investments/'+user.uid),{
amount,
plan,
startDate:Date.now(),
paid:false
});

alert("Investment Started");
};

/* WITHDRAW */
window.requestWithdraw = async()=>{
const user=auth.currentUser;
const amount=parseFloat(document.getElementById("withdrawAmount").value);
const wallet=document.getElementById("withdrawWallet").value;
const network=document.getElementById("withdrawNetwork").value;

if(!amount||!wallet) return alert("Fill all fields");

const userSnap=await get(ref(db,'users/'+user.uid));
let balance=userSnap.val()?.balance||0;

if(amount>balance) return alert("Cannot withdraw more than balance");

await push(ref(db,'withdrawals/'+user.uid),{
amount,
wallet,
network,
status:"pending",
date:Date.now()
});

alert("Withdrawal request submitted");
};

/* MATURITY */
function loadInvestments(user){
onValue(ref(db,'investments/'+user.uid),(snap)=>{
const data=snap.val();
if(!data) return;

let html="";
for(const id in data){
const inv=data[id];
const days=Math.floor((Date.now()-inv.startDate)/(24*60*60*1000));
if(days>=30 && !inv.paid){
html+=`<div>Plan $${inv.amount} matured
<button onclick="claimProfit('${id}',${inv.amount})">Claim</button></div>`;
}else{
html+=`<div>Plan $${inv.amount} - ${days}/30 days</div>`;
}
}
document.getElementById("investments").innerHTML=html;
});
}

window.claimProfit = async(id,amount)=>{
const user=auth.currentUser;
const rate= amount===20?0.10:0.05;
const totalProfit=amount + (amount*rate*30);

const userRef=ref(db,'users/'+user.uid);
const snap=await get(userRef);
let balance=snap.val()?.balance||0;

await update(userRef,{balance:balance+totalProfit});
await update(ref(db,'investments/'+user.uid+'/'+id),{paid:true});

alert("Profit Claimed");
};

</script>
</body>
  </html>
